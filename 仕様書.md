# 食べログ風レビュ―サイト 機能要件定義書

## 1. システム概要

* **目的**
  会員登録なしで、店舗情報と口コミを投稿・閲覧できる簡易なグルメレビューサイトを構築する。
  ローカル環境で動作確認できるレベルのシンプル構成とする。

* **特徴**

  * ユーザー登録・ログイン機能なし
  * 店舗登録は誰でも可能（匿名）
  * 各店舗に対する口コミ投稿も誰でも可能（匿名）
  * 最低限のバリデーションとスパム対策のみ実装

* **想定利用環境**

  * ローカル PC 上での動作確認
  * シングルユーザー or 小規模テスト利用

---

## 2. 使用技術・構成

* **フロントエンド**

  * Next.js (App Router)
  * TypeScript
  * Tailwind CSS
  * shadcn/ui
  * Radix UI
  * Lucide Icons
  * Framer-motion

* **バックエンド**

  * Next.js 内 API Routes を利用したローカルバックエンド

* **データベース**

  * SQLite（ローカルファイル）
  * ORM 利用可（例：Prisma）※実装時の選択に委ねる

---

## 3. 画面・機能一覧

1. トップ／店舗一覧画面
2. 店舗詳細・口コミ一覧画面
3. 店舗登録画面
4. 店舗検索・絞り込み機能（一覧画面内の機能として実装）
5. 口コミ投稿機能（店舗詳細画面内の機能として実装）
6. 簡易管理機能（投稿者自身による削除用パスワード）

---

## 4. 画面別機能要件

### 4.1 トップ／店舗一覧画面

**URL 例**

* `/`
* `/stores`

**表示内容**

* サイトヘッダー

  * サイト名
  * 「店舗一覧」リンク
  * 「店舗を登録する」ボタン（店舗登録画面への遷移）
* 店舗一覧

  * 店舗名
  * エリア（任意）
  * カテゴリ（例：ラーメン、カフェ 等 / 任意）
  * 平均評価（小数1桁表示）
  * 口コミ件数
  * 最近の口コミ投稿日（任意）
* 検索・絞り込み UI

  * 店舗名キーワード検索（部分一致）
  * エリア選択（セレクトボックスまたはフリーテキスト）
  * カテゴリ選択
* 並び替え

  * デフォルト：新着店舗順
  * オプション：評価の高い順、口コミ数の多い順

**機能**

1. **店舗一覧取得**

   * DB から店舗データを取得し、ページング表示（例：1ページ20件）。
2. **検索・絞り込み**

   * フロントからクエリパラメータで API に条件を渡し、サーバー側でフィルタリング。
3. **並び替え**

   * 並び順指定をクエリパラメータで API に渡し、サーバー側でソート。
4. **店舗詳細への遷移**

   * 店舗名クリックで `/stores/[id]` へ遷移。
5. **UI/UX**

   * 店舗カードを shadcn/ui + Tailwind で表示。
   * ホバー時に Framer-motion で軽いアニメーション。
   * アイコン類は Lucide Icons を使用（レビュー数アイコン、スターアイコン等）。

---

### 4.2 店舗詳細・口コミ一覧画面

**URL 例**

* `/stores/[storeId]`

**表示内容**

* 店舗基本情報

  * 店舗名（必須）
  * 住所（任意）
  * エリア（任意）
  * カテゴリ（任意）
  * 電話番号（任意）
  * 営業時間（任意・テキスト）
  * 予算帯（任意・例：〜1000円 / 1000〜3000円 等）
  * 店舗説明文（任意）
* 総合評価

  * 平均スコア（1.0〜5.0、0.5刻み程度）
  * 口コミ件数
* 口コミ一覧

  * ニックネーム（任意）
  * 評価（1〜5）
  * タイトル（任意）
  * 本文
  * 来店日時（任意 / テキスト）
  * 投稿日時（自動）
* 口コミ投稿フォーム（画面下部またはモーダル）
* 「店舗情報を編集/削除するための案内」（編集用パスワードを使う）

**機能**

1. **店舗詳細取得**

   * storeId をキーに店舗情報を取得。
   * 関連する口コミを同時に取得。
2. **平均評価の算出**

   * レビューの評価スコアの平均値を算出し表示。
3. **口コミ一覧表示**

   * 新着順に表示。
   * 件数が多い場合は簡易ページング or 「もっと見る」ボタン。
4. **口コミ投稿**

   * 入力項目

     * 評価（必須、1〜5）
     * ニックネーム（任意、テキスト）
     * タイトル（任意、テキスト）
     * 本文（必須）
     * 来店日時（任意、テキスト or 日付）
     * 編集用パスワード（任意、削除・編集操作用）
   * 必須チェック
   * 投稿成功時に一覧へ即時反映（楽観的 UI 更新または再フェッチ）
5. **口コミ削除（簡易）**

   * 投稿時に設定した「編集用パスワード」を入力することで、その口コミを削除可能にする簡易機能（本人確認代替）。
   * ローカル用途のため、UI はシンプルなモーダルで良い。
6. **UI/UX**

   * 店舗情報カードを shadcn/ui の Card コンポーネントベースで構築。
   * 口コミカードに Lucide のスターアイコンを表示。
   * フォームの開閉に Framer-motion を使用。

---

### 4.3 店舗登録画面

**URL 例**

* `/stores/new`

**表示内容**

* 店舗登録フォーム

  * 店舗名（必須）
  * 住所（任意）
  * エリア（任意）
  * カテゴリ（任意 / セレクト + フリーテキスト）
  * 電話番号（任意）
  * 営業時間（任意）
  * 予算帯（任意）
  * 店舗説明（任意）
  * 編集用パスワード（任意 / 登録者が後で削除したい場合に利用）
* 「登録する」ボタン
* 「トップに戻る」リンク

**機能**

1. **店舗登録**

   * 必須項目：店舗名
   * バリデーション

     * 店舗名の文字数チェック（例：1〜100文字）
     * その他項目は最大文字数のみチェック。
   * 登録成功時の動作

     * 店舗詳細画面 `/stores/[storeId]` へリダイレクト。
2. **店舗削除（簡易）**

   * 店舗登録時に設定された編集用パスワードで、店舗自体を削除できる API を用意。
   * ローカル用途のため、削除 UI は店舗詳細画面に「店舗を削除する（パスワード必須）」として簡易実装。

---

### 4.4 検索・絞り込み機能

**利用箇所**

* 主に店舗一覧画面

**機能要件**

1. **キーワード検索**

   * 店舗名に対して部分一致で検索。
   * 大文字小文字の違いは無視（必要なら）。
2. **エリア絞り込み**

   * エリア項目で完全一致 or 部分一致検索。
3. **カテゴリ絞り込み**

   * カテゴリ項目で完全一致検索（セレクトボックスで選択された値）。
4. **組み合わせ**

   * 上記条件は AND 条件で絞り込み。
5. **実装簡略化**

   * クライアント側で全件取得 → フロントでフィルタでも可だが、店舗数増加を考え、一応 API パラメータでフィルタリングする設計とする。

---

## 5. データ要件（テーブル定義の概要）

### 5.1 店舗テーブル（stores）

| 項目名            | 型          | 必須 | 説明             |
| -------------- | ---------- | -- | -------------- |
| id             | INTEGER PK | ○  | 店舗ID（自動採番）     |
| name           | TEXT       | ○  | 店舗名            |
| address        | TEXT       | -  | 住所             |
| area           | TEXT       | -  | エリア            |
| category       | TEXT       | -  | カテゴリ           |
| phone          | TEXT       | -  | 電話番号           |
| business_hours | TEXT       | -  | 営業時間           |
| budget_range   | TEXT       | -  | 予算帯            |
| description    | TEXT       | -  | 店舗説明           |
| edit_password  | TEXT       | -  | 店舗作成時の編集用パスワード |
| created_at     | DATETIME   | ○  | 作成日時           |
| updated_at     | DATETIME   | ○  | 更新日時           |

### 5.2 口コミテーブル（reviews）

| 項目名           | 型          | 必須 | 説明                |
| ------------- | ---------- | -- | ----------------- |
| id            | INTEGER PK | ○  | 口コミID（自動採番）       |
| store_id      | INTEGER FK | ○  | 対象店舗ID（stores.id） |
| rating        | INTEGER    | ○  | 評価（1〜5）           |
| nickname      | TEXT       | -  | ニックネーム            |
| title         | TEXT       | -  | タイトル              |
| body          | TEXT       | ○  | 本文                |
| visit_date    | TEXT       | -  | 来店日時（テキスト）        |
| edit_password | TEXT       | -  | 編集・削除用パスワード       |
| created_at    | DATETIME   | ○  | 投稿日時              |

---

## 6. API 要件（概要）

Next.js の App Router 内で Route Handlers を利用し、以下のような API を提供する想定。

### 6.1 店舗関連

* `GET /api/stores`

  * クエリ：`q`, `area`, `category`, `sort`, `page`, `limit`
  * 機能：店舗一覧取得（検索・絞り込み・ソート・ページング）

* `GET /api/stores/[id]`

  * 機能：単一店舗詳細と、その店舗に紐づく口コミ一覧を返す

* `POST /api/stores`

  * 機能：新規店舗登録

* `DELETE /api/stores/[id]`

  * ボディ：`edit_password`
  * 機能：パスワード一致時のみ店舗削除

### 6.2 口コミ関連

* `POST /api/stores/[id]/reviews`

  * 機能：対象店舗への口コミ投稿

* `DELETE /api/reviews/[id]`

  * ボディ：`edit_password`
  * 機能：パスワード一致時のみ口コミ削除

---

## 7. バリデーション要件（最低限）

* 店舗名：必須、1〜100文字
* 口コミ本文：必須、1〜1000文字程度
* 評価：1〜5 の整数のみ許可
* 文字列項目：過度に長い入力の制限（例：255〜1000文字程度）
* HTML / スクリプトタグのエスケープ（XSS 対策のため表示側でサニタイズ）

---

## 8. 簡易スパム・不正対策（ローカル用の最小限）

* 同一 IP（またはブラウザ）からの連続投稿に対し、短時間での連投を制限（例：10秒以内に複数投稿をブロック）
* 編集用パスワードは平文保存でもよいが、可能であればハッシュ化（ローカル用途のため任意）

---

